@{
    ViewData["Title"] = "Notes";
}
<script>
    
    

    function NoteModel(data)
    {
        var self = this;
        self.id = ko.observable(data.id);
        self.text = ko.observable(data.text);
        
        self.ConnectedWith = ko.observableArray(
            ko.utils.arrayMap(data.connectedWith, function(elem) {
                    return new NoteModel(elem);
                }
            )
        );

        self.RawViewIsEnabled = ko.observable(false);
        self.EnableRawView = function(){
            self.RawViewIsEnabled(true);
        };
        self.DisableRawView = function() {
            self.RawViewIsEnabled(false);
        };
    };

    function toJsWithoutFunctions(data) {
        var model = ko.toJS(data);
            for(var x in model) {
                if(typeof(model[x]) === "function") {
                    model[x] = null;
                }
            }
        return model;
    };

    function ConnectedNotesViewModel()
    {
        var self = this;
        
        self.Notes = ko.observableArray([]);
        

        self.RetrieveDataFromServer = function() {
            $.ajax({
                type: "POST",
                url: "Home/RetrieveAllNotes",
                data: {
                    
                },
                success: function(data) {
                    var toAdd = ko.utils.arrayMap(data, function(elem) {
                        return new NoteModel(elem);
                    });
                    ko.utils.arrayPushAll(self.Notes, toAdd);

                },
                dataType: "json"
            });

        };

        self.MakeNewEmptyNode = function() {
            $.ajax({
                type: "POST",
                url: "Home/MakeNewNode",
                success: function(data) {
                    var toAdd = new NodeModel(data);
                    self.Notes.push(toAdd);

                },
                dataType: "json"
            });
        };

        

    };

    $(document).ready(function()
    {
        var viewModel = new ConnectedNotesViewModel();
        ko.applyBindings(viewModel);
        viewModel.RetrieveDataFromServer();
    });
</script>
<script type="text/html" id="node-template">
    <li>
    <span>
        <span data-bind="text: '#'"></span>
        <span data-bind="text: id"></span>
        <span data-bind="text: ','"></span>
    </span>
    <span>
        <span data-bind="ifnot: RawViewIsEnabled">
            <span data-bind="text: text"></span>
            <button data-bind="click: EnableRawView" >Edit</button>
        </span>
        <span data-bind="if: RawViewIsEnabled">
            <input data-bind="value: text"></input>
            <ul data-bind="foreach: ConnectedWith">
                <li >
                    <button data-bind="click: $parent.Disconnect">Disconnect</button>
                    <span data-bind="text: '#'"></span>
                    <span data-bind="text: id"></span>
                    <input data-bind="value: text"></input>
                </li>
            </ul>
            <br>
        </span>
        
        <span data-bind="if: RawViewIsEnabled">
            <button data-bind="click: DisableRawView" >Collapse</button>
        </span>
    </span>
    </li>
</script>
<div>
        <ul data-bind="template: {name: 'node-template', foreach: Notes} ">
        </ul>
    
</div>